---
import BaseLayout from '@/layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const allPosts = await getCollection('blog', ({ data }) => !data.draft);

// Count posts per tag
const tagCounts = allPosts.reduce((acc, post) => {
  post.data.tags.forEach((tag) => {
    acc[tag] = (acc[tag] || 0) + 1;
  });
  return acc;
}, {} as Record<string, number>);

const tags = Object.entries(tagCounts)
  .sort(([a], [b]) => a.localeCompare(b))
  .map(([tag, count]) => ({ tag, count }));
---

<BaseLayout title="Tags">
  <div class="container py-8 md:py-12 lg:py-16">
    <div class="flex flex-col gap-4 mb-10">
      <h1 class="text-4xl font-extrabold tracking-tight lg:text-5xl">Tags</h1>
      <p class="text-xl text-muted-foreground">
        Browse posts by tag.
      </p>
    </div>

    <div class="flex flex-wrap gap-3">
      {tags.map(({ tag, count }) => (
        <a
          href={`/tags/${tag}`}
          class="inline-flex items-center gap-2 rounded-lg border bg-card px-4 py-2 text-sm font-medium transition-all hover:bg-accent hover:text-accent-foreground hover:shadow-md"
        >
          <span>{tag}</span>
          <span class="rounded-full bg-muted px-2 py-0.5 text-xs font-semibold">
            {count}
          </span>
        </a>
      ))}
    </div>
  </div>
</BaseLayout>
